<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÂÜôÁúüÊï¥ÁêÜ„ÉÑ„Éº„É´ GUIÁâà - Photo Organizer</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.2em;
        opacity: 0.9;
      }

      .main-content {
        padding: 40px;
      }

      .section {
        margin-bottom: 40px;
        padding: 30px;
        border: 2px dashed #e0e0e0;
        border-radius: 10px;
        transition: all 0.3s ease;
      }

      .section:hover {
        border-color: #4facfe;
        background-color: #f8f9ff;
      }

      .section h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.5em;
        display: flex;
        align-items: center;
      }

      .section h2::before {
        content: "üìÅ";
        margin-right: 10px;
        font-size: 1.2em;
      }

      .file-input-wrapper {
        position: relative;
        display: inline-block;
        width: 100%;
      }

      .file-input {
        position: absolute;
        opacity: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
      }

      .file-input-button {
        display: block;
        width: 100%;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        text-align: center;
        border-radius: 10px;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
      }

      .file-input-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      }

      .selected-folder {
        margin-top: 15px;
        padding: 15px;
        background: #e8f5e8;
        border-radius: 8px;
        border-left: 4px solid #4caf50;
      }

      .file-list {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #ddd;
        border-radius: 8px;
        margin-top: 20px;
      }

      .file-item {
        padding: 10px 15px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .file-item:last-child {
        border-bottom: none;
      }

      .file-item:nth-child(even) {
        background-color: #f9f9f9;
      }

      .file-name {
        font-weight: 500;
        color: #333;
      }

      .file-extension {
        background: #e3f2fd;
        color: #1976d2;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: bold;
      }

      .preview-section {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
      }

      .preview-section h3 {
        color: #495057;
        margin-bottom: 15px;
        font-size: 1.2em;
      }

      .folder-preview {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 15px;
      }

      .folder-card {
        background: white;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #4facfe;
      }

      .folder-card h4 {
        color: #333;
        margin-bottom: 8px;
        font-size: 1em;
      }

      .folder-card .file-count {
        color: #666;
        font-size: 0.9em;
      }

      .action-buttons {
        display: flex;
        gap: 15px;
        margin-top: 30px;
        justify-content: center;
      }

      .btn {
        padding: 15px 30px;
        border: none;
        border-radius: 8px;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        text-align: center;
      }

      .btn-primary {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
      }

      .btn-secondary {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        color: #333;
      }

      .btn-danger {
        background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        color: #333;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #4facfe;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #666;
        font-size: 0.9em;
      }

      .progress-bar {
        width: 100%;
        height: 20px;
        background: #e0e0e0;
        border-radius: 10px;
        overflow: hidden;
        margin: 20px 0;
        display: none;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        width: 0%;
        transition: width 0.3s ease;
      }

      .log-section {
        background: #2d3748;
        color: #e2e8f0;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
        font-family: "Courier New", monospace;
        max-height: 300px;
        overflow-y: auto;
        display: none;
      }

      .log-entry {
        margin-bottom: 5px;
        padding: 5px 0;
      }

      .log-success {
        color: #68d391;
      }

      .log-error {
        color: #fc8181;
      }

      .log-info {
        color: #63b3ed;
      }

      .warning {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
      }

      .warning::before {
        content: "‚ö†Ô∏è ";
        font-weight: bold;
      }

      /* „É¢„Éº„ÉÄ„É´„Çπ„Çø„Ç§„É´ */
      .modal {
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
      }

      .modal-content {
        background-color: white;
        margin: 5% auto;
        padding: 0;
        border-radius: 15px;
        width: 90%;
        max-width: 600px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        animation: modalSlideIn 0.3s ease;
      }

      @keyframes modalSlideIn {
        from {
          transform: translateY(-50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .modal-header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 20px 30px;
        border-radius: 15px 15px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-header h2 {
        margin: 0;
        font-size: 1.5em;
      }

      .close {
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.3s;
      }

      .close:hover {
        opacity: 1;
      }

      .modal-body {
        padding: 30px;
        line-height: 1.6;
      }

      .step {
        margin-bottom: 25px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        border-left: 4px solid #4facfe;
      }

      .step h3 {
        color: #333;
        margin-bottom: 10px;
        font-size: 1.2em;
      }

      .execution-options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 15px;
      }

      .option {
        background: white;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
      }

      .option h4 {
        color: #4facfe;
        margin-bottom: 8px;
        font-size: 1em;
      }

      .option code {
        background: #2d3748;
        color: #e2e8f0;
        padding: 8px 12px;
        border-radius: 5px;
        font-family: monospace;
        display: block;
        margin-top: 8px;
      }

      .modal-footer {
        padding: 20px 30px;
        text-align: center;
        border-top: 1px solid #e0e0e0;
      }

      @media (max-width: 768px) {
        .main-content {
          padding: 20px;
        }

        .action-buttons {
          flex-direction: column;
        }

        .stats {
          grid-template-columns: repeat(2, 1fr);
        }

        .modal-content {
          width: 95%;
          margin: 10% auto;
        }

        .execution-options {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üì∏ ÂÜôÁúüÊï¥ÁêÜ„ÉÑ„Éº„É´ GUIÁâà</h1>
        <p>Âêå„ÅòÂêçÂâç„ÅÆÂÜôÁúü„Éï„Ç°„Ç§„É´„ÇíÁ∞°Âçò„Å´„Éï„Ç©„É´„ÉÄÂàÜ„Åë„Åß„Åç„Åæ„Åô</p>
      </div>

      <div class="main-content">
        <!-- „Éï„Ç©„É´„ÉÄÈÅ∏Êäû„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="section">
          <h2>„Éï„Ç©„É´„ÉÄ„ÇíÈÅ∏Êäû</h2>
          <div class="file-input-wrapper">
            <input
              type="file"
              id="folderInput"
              class="file-input"
              webkitdirectory
              multiple
            />
            <label for="folderInput" class="file-input-button">
              üìÅ Êï¥ÁêÜ„Åó„Åü„ÅÑÂÜôÁúü„Éï„Ç©„É´„ÉÄ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ
            </label>
          </div>
          <div
            id="selectedFolder"
            class="selected-folder"
            style="display: none"
          >
            <strong>ÈÅ∏Êäû„Åï„Çå„Åü„Éï„Ç©„É´„ÉÄ:</strong> <span id="folderPath"></span>
          </div>
        </div>

        <!-- Áµ±Ë®àÊÉÖÂ†± -->
        <div id="statsSection" style="display: none">
          <div class="stats">
            <div class="stat-card">
              <div class="stat-number" id="totalFiles">0</div>
              <div class="stat-label">ÁîªÂÉè„Éï„Ç°„Ç§„É´</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="totalGroups">0</div>
              <div class="stat-label">‰ΩúÊàê‰∫àÂÆö„Éï„Ç©„É´„ÉÄ</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="duplicateFiles">0</div>
              <div class="stat-label">Ë§áÊï∞‰∫∫Âêç„Éï„Ç°„Ç§„É´</div>
            </div>
          </div>
        </div>

        <!-- „Éï„Ç°„Ç§„É´‰∏ÄË¶ß -->
        <div id="fileListSection" class="section" style="display: none">
          <h2>Ê§úÂá∫„Åï„Çå„ÅüÁîªÂÉè„Éï„Ç°„Ç§„É´</h2>
          <div id="fileList" class="file-list"></div>
        </div>

        <!-- „Éó„É¨„Éì„É•„Éº„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div id="previewSection" class="preview-section" style="display: none">
          <h3>üìã Êï¥ÁêÜ„Éó„É¨„Éì„É•„Éº</h3>
          <div class="warning">
            „Åì„ÅÆ„Éó„É¨„Éì„É•„Éº„ÅØÂÆüÈöõ„ÅÆ„Éï„Ç°„Ç§„É´ÁßªÂãï„ÅÆ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Åß„Åô„ÄÇ„ÄåÊï¥ÁêÜ„ÇíÂÆüË°å„Äç„Éú„Çø„É≥„ÇíÊäº„Åô„Å®„ÄÅ„Éñ„É©„Ç¶„Ç∂„ÅÆÂà∂Èôê„Å´„Çà„ÇäÂÆüÈöõ„ÅÆ„Éï„Ç°„Ç§„É´ÁßªÂãï„ÅØ„Åß„Åç„Åæ„Åõ„Çì„Åå„ÄÅÊï¥ÁêÜË®àÁîª„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åß„Åç„Åæ„Åô„ÄÇ
          </div>
          <div id="folderPreview" class="folder-preview"></div>
        </div>

        <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
        <div class="action-buttons">
          <button
            id="analyzeBtn"
            class="btn btn-secondary"
            onclick="analyzeFiles()"
            disabled
          >
            üîç „Éï„Ç°„Ç§„É´„ÇíËß£Êûê
          </button>
          <button
            id="previewBtn"
            class="btn btn-primary"
            onclick="showPreview()"
            disabled
          >
            üëÅÔ∏è Êï¥ÁêÜ„Éó„É¨„Éì„É•„Éº
          </button>
          <button
            id="organizeBtn"
            class="btn btn-danger"
            onclick="startOrganization()"
            disabled
          >
            üöÄ Êï¥ÁêÜ„ÇíÈñãÂßã
          </button>
          <button
            id="downloadBtn"
            class="btn btn-secondary"
            onclick="downloadOrganizationFiles()"
            disabled
          >
            üíæ ÊâãÂãïÂÆüË°åÁî®„Éï„Ç°„Ç§„É´
          </button>
        </div>

        <!-- „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº -->
        <div id="progressBar" class="progress-bar">
          <div id="progressFill" class="progress-fill"></div>
        </div>

        <!-- „É≠„Ç∞„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div id="logSection" class="log-section">
          <div id="logContent"></div>
        </div>
      </div>
    </div>

    <!-- ÂÆüË°åÊâãÈ†Ü„É¢„Éº„ÉÄ„É´ -->
    <div id="executionModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>üöÄ ÂÜôÁúüÊï¥ÁêÜ„ÅÆÂÆüË°åÊâãÈ†Ü</h2>
          <span class="close" onclick="closeModal()">&times;</span>
        </div>
        <div class="modal-body">
          <div class="step">
            <h3>üìÅ „Çπ„ÉÜ„ÉÉ„Éó 1: „Éï„Ç°„Ç§„É´„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</h3>
            <p>‰ª•‰∏ã„ÅÆ„Éï„Ç°„Ç§„É´„Åå„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åï„Çå„Åæ„Åó„ÅüÔºö</p>
            <ul>
              <li>
                <strong>photo_organizer_custom.py</strong> - Êï¥ÁêÜ„Çπ„ÇØ„É™„Éó„Éà
              </li>
              <li>
                <strong>run_organizer.bat</strong> -
                ÂÆüË°åÁî®„Éê„ÉÉ„ÉÅ„Éï„Ç°„Ç§„É´ÔºàWindowsÔºâ
              </li>
              <li><strong>organization_plan.csv</strong> - Êï¥ÁêÜË®àÁîª„É¨„Éù„Éº„Éà</li>
            </ul>
          </div>

          <div class="step">
            <h3>üìÇ „Çπ„ÉÜ„ÉÉ„Éó 2: „Éï„Ç°„Ç§„É´„ÇíÁßªÂãï</h3>
            <p>
              „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åü„Éï„Ç°„Ç§„É´„Çí<strong>Êï¥ÁêÜ„Åó„Åü„ÅÑÂÜôÁúü„Éï„Ç©„É´„ÉÄ</strong>„Å´ÁßªÂãï„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
            </p>
          </div>

          <div class="step">
            <h3>‚ñ∂Ô∏è „Çπ„ÉÜ„ÉÉ„Éó 3: ÂÆüË°å</h3>
            <div class="execution-options">
              <div class="option">
                <h4>üñ±Ô∏è Á∞°ÂçòÂÆüË°åÔºàWindowsÔºâ</h4>
                <p><code>run_organizer.bat</code> „Çí„ÉÄ„Éñ„É´„ÇØ„É™„ÉÉ„ÇØ</p>
              </div>
              <div class="option">
                <h4>‚å®Ô∏è „Ç≥„Éû„É≥„Éâ„É©„Ç§„É≥ÂÆüË°å</h4>
                <p>ÂÜôÁúü„Éï„Ç©„É´„ÉÄ„Åß„Ç≥„Éû„É≥„Éâ„Éó„É≠„É≥„Éó„Éà„ÇíÈñã„ÅçÔºö</p>
                <code>python photo_organizer_custom.py</code>
              </div>
            </div>
          </div>

          <div class="warning">
            <strong>‚ö†Ô∏è Ê≥®ÊÑè‰∫ãÈ†Ö</strong><br />
            ‚Ä¢ ÂÆüË°åÂâç„Å´ÈáçË¶Å„Å™„Éï„Ç°„Ç§„É´„ÅÆ„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÇíÂèñ„Çã„Åì„Å®„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô<br />
            ‚Ä¢ 1„Éï„Ç°„Ç§„É´„ÅÆ„Åø„ÅÆ„Ç∞„É´„Éº„Éó„ÅØÊó¢Â≠ò„Éï„Ç©„É´„ÉÄ„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøÁßªÂãï„Åï„Çå„Åæ„Åô<br />
            ‚Ä¢ ÂêåÂêç„Éï„Ç°„Ç§„É´„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØËá™ÂãïÁöÑ„Å´„É™„Éç„Éº„É†„Åï„Çå„Åæ„Åô
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" onclick="closeModal()">
            ÁêÜËß£„Åó„Åæ„Åó„Åü
          </button>
        </div>
      </div>
    </div>

    <script>
      let selectedFiles = [];
      let organizationPlan = {};
      let existingFolders = new Set();

      // „Éï„Ç°„Ç§„É´ÈÅ∏ÊäûÊôÇ„ÅÆÂá¶ÁêÜ
      document
        .getElementById("folderInput")
        .addEventListener("change", function (event) {
          selectedFiles = Array.from(event.target.files);

          if (selectedFiles.length > 0) {
            const folderPath =
              selectedFiles[0].webkitRelativePath.split("/")[0];
            document.getElementById("folderPath").textContent = folderPath;
            document.getElementById("selectedFolder").style.display = "block";
            document.getElementById("analyzeBtn").disabled = false;

            log("„Éï„Ç©„É´„ÉÄ„ÅåÈÅ∏Êäû„Åï„Çå„Åæ„Åó„Åü: " + folderPath, "info");
          }
        });

      // „É≠„Ç∞Âá∫ÂäõÈñ¢Êï∞
      function log(message, type = "info") {
        const logSection = document.getElementById("logSection");
        const logContent = document.getElementById("logContent");

        logSection.style.display = "block";

        const logEntry = document.createElement("div");
        logEntry.className = `log-entry log-${type}`;
        logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;

        logContent.appendChild(logEntry);
        logContent.scrollTop = logContent.scrollHeight;
      }

      // „Éï„Ç°„Ç§„É´Ëß£Êûê
      function analyzeFiles() {
        if (selectedFiles.length === 0) {
          alert("„Éï„Ç©„É´„ÉÄ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
          return;
        }

        log("„Éï„Ç°„Ç§„É´Ëß£Êûê„ÇíÈñãÂßã„Åó„Åæ„Åô...", "info");

        // ÁîªÂÉè„Éï„Ç°„Ç§„É´„ÅÆ„Åø„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
        const imageExtensions = [
          ".jpg",
          ".jpeg",
          ".jfif",
          ".jpe", // JPEGÁ≥ª
          ".png",
          ".gif",
          ".bmp",
          ".tiff",
          ".tif", // ‰∏ÄËà¨ÁöÑ„Å™ÂΩ¢Âºè
          ".webp",
          ".avif",
          ".heic",
          ".heif", // Êñ∞„Åó„ÅÑÂΩ¢Âºè
          ".raw",
          ".cr2",
          ".nef",
          ".arw",
          ".dng", // RAWÂΩ¢Âºè
          ".svg",
          ".ico", // „Åù„ÅÆ‰ªñ
        ];
        const imageFiles = selectedFiles.filter((file) => {
          const extension = "." + file.name.split(".").pop().toLowerCase();
          return imageExtensions.includes(extension);
        });

        log(`${imageFiles.length} ÂÄã„ÅÆÁîªÂÉè„Éï„Ç°„Ç§„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„Åü`, "success");

        // „Éï„Ç°„Ç§„É´‰∏ÄË¶ß„ÇíË°®Á§∫
        displayFileList(imageFiles);

        // Áµ±Ë®àÊÉÖÂ†±„ÇíÊõ¥Êñ∞
        updateStats(imageFiles);

        // „Éú„Çø„É≥„ÇíÊúâÂäπÂåñ
        document.getElementById("previewBtn").disabled = false;

        log("„Éï„Ç°„Ç§„É´Ëß£Êûê„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü", "success");
      }

      // „Éï„Ç°„Ç§„É´‰∏ÄË¶ßË°®Á§∫
      function displayFileList(files) {
        const fileList = document.getElementById("fileList");
        fileList.innerHTML = "";

        files.forEach((file) => {
          const fileItem = document.createElement("div");
          fileItem.className = "file-item";

          const fileName = document.createElement("span");
          fileName.className = "file-name";
          fileName.textContent = file.name;

          const fileExt = document.createElement("span");
          fileExt.className = "file-extension";
          fileExt.textContent = "." + file.name.split(".").pop().toUpperCase();

          fileItem.appendChild(fileName);
          fileItem.appendChild(fileExt);
          fileList.appendChild(fileItem);
        });

        document.getElementById("fileListSection").style.display = "block";
      }

      // Áµ±Ë®àÊÉÖÂ†±Êõ¥Êñ∞
      function updateStats(files) {
        const groups = analyzeFileGroups(files);
        const duplicateCount = countDuplicateNameFiles(files, groups);

        document.getElementById("totalFiles").textContent = files.length;
        document.getElementById("totalGroups").textContent =
          Object.keys(groups).length;
        document.getElementById("duplicateFiles").textContent = duplicateCount;
        document.getElementById("statsSection").style.display = "block";
      }

      // „Éï„Ç°„Ç§„É´„Ç∞„É´„Éº„ÉóËß£ÊûêÔºà1„Éï„Ç°„Ç§„É´„ÅÆ„Ç∞„É´„Éº„Éó„ÅØÈô§Â§ñÔºâ
      function analyzeFileGroups(files) {
        const groups = {};

        files.forEach((file) => {
          const fileName = file.name.replace(/\.[^/.]+$/, ""); // Êã°ÂºµÂ≠ê„ÇíÈô§Âéª

          // ÁâπÊÆä„Éë„Çø„Éº„É≥„ÅÆÈô§Âéª
          let cleanName = fileName.replace(/\s*-?\s*„Ç≥„Éî„Éº$/, "");
          cleanName = cleanName.replace(/\s*„Ç≥„Éî„Éº$/, "");
          cleanName = cleanName.replace(
            /photo-\d+\s*\(\d+\)\s*-?\s*„Ç≥„Éî„Éº$/,
            ""
          );

          // "ÂêçÂâç (Êï∞Â≠ó)" „Éë„Çø„Éº„É≥„ÅÆÂá¶ÁêÜ
          const match = cleanName.match(/^(.+?)\s*\((\d+)\)$/);
          const baseName = match ? match[1].trim() : cleanName.trim();

          if (!groups[baseName]) {
            groups[baseName] = [];
          }
          groups[baseName].push(file);
        });

        // 1„Éï„Ç°„Ç§„É´„ÅÆ„Ç∞„É´„Éº„Éó„ÇíÈô§Â§ñ
        const filteredGroups = {};
        Object.keys(groups).forEach((baseName) => {
          if (groups[baseName].length > 1) {
            filteredGroups[baseName] = groups[baseName];
          }
        });

        organizationPlan = filteredGroups;
        return filteredGroups;
      }

      // Ë§áÊï∞‰∫∫Âêç„Éï„Ç°„Ç§„É´„ÅÆ„Ç´„Ç¶„É≥„Éà
      function countDuplicateNameFiles(files, groups) {
        // „Åì„ÅÆÂÆüË£Ö„Åß„ÅØÁ∞°Âçò„Å™‰æã„Å®„Åó„Å¶„ÄÅÊó¢Â≠ò„Éï„Ç©„É´„ÉÄÂêç„ÅßÂßã„Åæ„Çã„Éï„Ç°„Ç§„É´„Çí„Ç´„Ç¶„É≥„Éà
        // ÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØ„ÄÅ„Çà„ÇäË§áÈõë„Å™„É≠„Ç∏„ÉÉ„ÇØ„ÅåÂøÖË¶Å
        return 0; // Á∞°Áï•Âåñ
      }

      // „Éó„É¨„Éì„É•„ÉºË°®Á§∫
      function showPreview() {
        if (Object.keys(organizationPlan).length === 0) {
          alert("„Åæ„Åö„Éï„Ç°„Ç§„É´„ÇíËß£Êûê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
          return;
        }

        log("Êï¥ÁêÜ„Éó„É¨„Éì„É•„Éº„ÇíÁîüÊàê‰∏≠...", "info");

        const folderPreview = document.getElementById("folderPreview");
        folderPreview.innerHTML = "";

        // „Çπ„Ç≠„ÉÉ„Éó„Åï„Çå„Çã„Éï„Ç°„Ç§„É´„ÅÆÊÉÖÂ†±„ÇíË°®Á§∫
        const allGroups = {};
        selectedFiles.forEach((file) => {
          const fileName = file.name.replace(/\.[^/.]+$/, "");
          let cleanName = fileName.replace(/\s*-?\s*„Ç≥„Éî„Éº$/, "");
          cleanName = cleanName.replace(/\s*„Ç≥„Éî„Éº$/, "");
          const match = cleanName.match(/^(.+?)\s*\((\d+)\)$/);
          const baseName = match ? match[1].trim() : cleanName.trim();

          if (!allGroups[baseName]) {
            allGroups[baseName] = [];
          }
          allGroups[baseName].push(file);
        });

        const skippedGroups = Object.keys(allGroups).filter(
          (name) => allGroups[name].length === 1 && !organizationPlan[name]
        );

        if (skippedGroups.length > 0) {
          const skipInfo = document.createElement("div");
          skipInfo.className = "warning";
          skipInfo.style.marginBottom = "20px";
          skipInfo.innerHTML = `
            <strong>üìù „Çπ„Ç≠„ÉÉ„Éó„Åï„Çå„Çã„Éï„Ç°„Ç§„É´:</strong><br>
            ${
              skippedGroups.length
            }ÂÄã„ÅÆ„Éï„Ç°„Ç§„É´„ÅØ1ÂÄã„ÅÆ„Åø„ÅÆ„Åü„ÇÅ„ÄÅ„Éï„Ç©„É´„ÉÄ„Å´ÁßªÂãï„Åï„Çå„Åæ„Åõ„Çì„ÄÇ<br>
            <small style="color: #666;">‰æã: ${skippedGroups
              .slice(0, 3)
              .join(", ")}${skippedGroups.length > 3 ? "..." : ""}</small>
          `;
          folderPreview.appendChild(skipInfo);
        }

        Object.entries(organizationPlan).forEach(([folderName, files]) => {
          const folderCard = document.createElement("div");
          folderCard.className = "folder-card";

          const folderTitle = document.createElement("h4");
          folderTitle.textContent = `üìÅ ${folderName}`;

          const fileCount = document.createElement("div");
          fileCount.className = "file-count";
          fileCount.textContent = `${files.length} „Éï„Ç°„Ç§„É´`;

          folderCard.appendChild(folderTitle);
          folderCard.appendChild(fileCount);

          // „Éï„Ç°„Ç§„É´Âêç„ÅÆ‰∏ÄÈÉ®„ÇíË°®Á§∫
          if (files.length > 0) {
            const fileNames = files
              .slice(0, 3)
              .map((f) => f.name)
              .join(", ");
            const fileList = document.createElement("div");
            fileList.style.fontSize = "0.8em";
            fileList.style.color = "#888";
            fileList.style.marginTop = "5px";
            fileList.textContent = fileNames + (files.length > 3 ? "..." : "");
            folderCard.appendChild(fileList);
          }

          folderPreview.appendChild(folderCard);
        });

        document.getElementById("previewSection").style.display = "block";
        document.getElementById("organizeBtn").disabled = false;
        document.getElementById("downloadBtn").disabled = false;

        log(
          `„Éó„É¨„Éì„É•„Éº„ÅåÁîüÊàê„Åï„Çå„Åæ„Åó„ÅüÔºà${
            Object.keys(organizationPlan).length
          }ÂÄã„ÅÆ„Éï„Ç©„É´„ÉÄ„ÄÅ${skippedGroups.length}ÂÄã„ÅÆ„Éï„Ç°„Ç§„É´„Çí„Çπ„Ç≠„ÉÉ„ÉóÔºâ`,
          "success"
        );
      }

      // Êï¥ÁêÜÈñãÂßãÔºàÁõ¥Êé•ÂÆüË°åÁâàÔºâ
      async function startOrganization() {
        if (Object.keys(organizationPlan).length === 0) {
          alert("Êï¥ÁêÜË®àÁîª„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ");
          return;
        }

        // Á¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞
        if (
          !confirm(
            "ÂÜôÁúü„Éï„Ç°„Ç§„É´„ÇíÂÆüÈöõ„Å´ÁßªÂãï„Åó„Åæ„Åô„ÄÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü\n\n‚ÄªÂÆüË°åÂâç„Å´„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÇíÂèñ„Çã„Åì„Å®„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô„ÄÇ"
          )
        ) {
          return;
        }

        log("ÂÜôÁúüÊï¥ÁêÜ„ÇíÈñãÂßã„Åó„Åæ„Åô...", "info");

        try {
          // „É≠„Éº„Ç´„É´Python„Çπ„ÇØ„É™„Éó„Éà„ÇíÂÆüË°å
          const response = await fetch("/execute-organizer", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              organizationPlan: organizationPlan,
              folderPath: selectedFiles[0].webkitRelativePath.split("/")[0],
            }),
          });

          if (response.ok) {
            const result = await response.json();
            log(
              `Êï¥ÁêÜÂÆå‰∫Ü: ${result.moved_files}„Éï„Ç°„Ç§„É´ÁßªÂãï„ÄÅ${result.created_folders}„Éï„Ç©„É´„ÉÄ‰ΩúÊàê`,
              "success"
            );

            if (result.errors && result.errors.length > 0) {
              result.errors.forEach((error) =>
                log(`„Ç®„É©„Éº: ${error}`, "error")
              );
            }
          } else {
            throw new Error("„Çµ„Éº„Éê„Éº„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü");
          }
        } catch (error) {
          log(`„Ç®„É©„Éº: ${error.message}`, "error");
          log("‰ª£ÊõøÊ°à: Êï¥ÁêÜË®àÁîª„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Å¶ÊâãÂãïÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ", "info");

          // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: „Éï„Ç°„Ç§„É´„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
          const pythonScript = generateCustomPythonScript();
          downloadFile(pythonScript, "photo_organizer_custom.py", "text/plain");

          const batchScript = generateBatchScript();
          downloadFile(batchScript, "run_organizer.bat", "text/plain");
        }
      }

      // ‰ª£ÊõøÂÆüË°åÊñπÊ≥ïÔºà„Éï„Ç°„Ç§„É´ÁîüÊàêÔºâ
      function downloadOrganizationFiles() {
        if (Object.keys(organizationPlan).length === 0) {
          alert("Êï¥ÁêÜË®àÁîª„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ");
          return;
        }

        log("Êï¥ÁêÜÁî®„Éï„Ç°„Ç§„É´„ÇíÁîüÊàê‰∏≠...", "info");

        // 1. „Ç´„Çπ„Çø„É†Python„Çπ„ÇØ„É™„Éó„Éà„ÇíÁîüÊàê„Éª„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
        const pythonScript = generateCustomPythonScript();
        downloadFile(pythonScript, "photo_organizer_custom.py", "text/plain");

        // 2. „Éê„ÉÉ„ÉÅ„Éï„Ç°„Ç§„É´„ÇíÁîüÊàê„Éª„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÔºàWindowsÁî®Ôºâ
        const batchScript = generateBatchScript();
        downloadFile(batchScript, "run_organizer.bat", "text/plain");

        // 3. CSV„É¨„Éù„Éº„Éà„ÇíÁîüÊàê„Éª„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
        const csvReport = generateCSVReport();
        downloadFile(csvReport, "organization_plan.csv", "text/csv");

        // 4. ÂÆüË°åÊâãÈ†Ü„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
        document.getElementById("executionModal").style.display = "block";

        log("Êï¥ÁêÜÁî®„Éï„Ç°„Ç§„É´„Åå„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åï„Çå„Åæ„Åó„Åü", "success");
      }

      // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
      function closeModal() {
        document.getElementById("executionModal").style.display = "none";
      }

      // „Éï„Ç°„Ç§„É´„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÁî®„Éò„É´„Éë„ÉºÈñ¢Êï∞
      function downloadFile(content, filename, mimeType) {
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      // Êï¥ÁêÜË®àÁîª„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
      function downloadOrganizationPlan() {
        if (Object.keys(organizationPlan).length === 0) {
          alert("Êï¥ÁêÜË®àÁîª„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ");
          return;
        }

        log("Êï¥ÁêÜË®àÁîª„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ‰∏≠...", "info");

        // Python„Çπ„ÇØ„É™„Éó„Éà„ÇíÁîüÊàê
        const pythonScript = generatePythonScript();

        // „ÉÜ„Ç≠„Çπ„Éà„Éï„Ç°„Ç§„É´„Å®„Åó„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
        const blob = new Blob([pythonScript], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "photo_organizer_plan.py";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        // CSV„É¨„Éù„Éº„Éà„ÇÇÁîüÊàê
        const csvReport = generateCSVReport();
        const csvBlob = new Blob([csvReport], { type: "text/csv" });
        const csvUrl = URL.createObjectURL(csvBlob);
        const csvA = document.createElement("a");
        csvA.href = csvUrl;
        csvA.download = "organization_plan.csv";
        document.body.appendChild(csvA);
        csvA.click();
        document.body.removeChild(csvA);
        URL.revokeObjectURL(csvUrl);

        log("Êï¥ÁêÜË®àÁîª„Åå„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åï„Çå„Åæ„Åó„Åü", "success");
      }

      // „Ç´„Çπ„Çø„É†Python„Çπ„ÇØ„É™„Éó„ÉàÁîüÊàêÔºà1„Éï„Ç°„Ç§„É´„Åß„ÇÇÊó¢Â≠ò„Éï„Ç©„É´„ÉÄ„Åå„ÅÇ„Çå„Å∞ÁßªÂãïÔºâ
      function generateCustomPythonScript() {
        let script = `#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ÂÜôÁúüÊï¥ÁêÜ„Çπ„ÇØ„É™„Éó„Éà - GUIÁâà„ÅßÁîüÊàêÔºà„Ç´„Çπ„Çø„É†ÁâàÔºâ
„Åì„ÅÆ„Çπ„ÇØ„É™„Éó„Éà„ÅØÂÜôÁúüÊï¥ÁêÜ„ÉÑ„Éº„É´GUIÁâà„ÅßÁîüÊàê„Åï„Çå„Åæ„Åó„Åü„ÄÇ

ÁâπÂæ¥:
- 2ÂÄã‰ª•‰∏ä„ÅÆÂêåÂêç„Éï„Ç°„Ç§„É´„Åå„ÅÇ„Çã„Ç∞„É´„Éº„Éó„ÇíÂá¶ÁêÜ
- 1ÂÄã„ÅÆ„Åø„ÅÆ„Éï„Ç°„Ç§„É´„Åß„ÇÇÊó¢Â≠ò„Éï„Ç©„É´„ÉÄ„Å®ÂêåÂêç„Å™„ÇâÁßªÂãï
- Ë§áÊï∞‰∫∫Âêç„Éï„Ç°„Ç§„É´„ÅÆËá™ÂãïÁµ±Âêà
"""

import os
import shutil
import re
from pathlib import Path

def get_unique_filename(folder_path, filename):
    """ÈáçË§á„Åó„Å™„ÅÑ„Éï„Ç°„Ç§„É´Âêç„ÇíÁîüÊàê"""
    destination_path = folder_path / filename
    
    if not destination_path.exists():
        return destination_path
    
    base_name = destination_path.stem
    extension = destination_path.suffix
    
    # Ë§áÈõë„Å™Áï™Âè∑„Éë„Çø„Éº„É≥„Çí„Åô„Åπ„Å¶Èô§Âéª
    clean_base_name = re.sub(r'\\s*\\(\\d+\\)(?:\\s*\\(\\d+\\))*\\s*$', '', base_name).strip()
    
    # „Éï„Ç©„É´„ÉÄÂÜÖ„ÅÆÊó¢Â≠ò„Éï„Ç°„Ç§„É´„Åã„ÇâÊúÄÂ§ßÁï™Âè∑„ÇíË¶ã„Å§„Åë„Çã
    max_number = 0
    if folder_path.exists():
        try:
            for existing_file in folder_path.iterdir():
                if existing_file.is_file() and existing_file.suffix.lower() == extension.lower():
                    existing_base = existing_file.stem
                    if existing_base.startswith(clean_base_name):
                        remaining = existing_base[len(clean_base_name):].strip()
                        if remaining == '':
                            max_number = max(max_number, 1)
                        else:
                            numbers = re.findall(r'\\((\\d+)\\)', remaining)
                            if numbers:
                                last_number = int(numbers[-1])
                                max_number = max(max_number, last_number)
        except Exception:
            max_number = 1
    
    counter = max_number + 1
    new_filename = f"{clean_base_name} ({counter}){extension}"
    new_destination_path = folder_path / new_filename
    
    while new_destination_path.exists() and counter <= 1000:
        counter += 1
        new_filename = f"{clean_base_name} ({counter}){extension}"
        new_destination_path = folder_path / new_filename
    
    if counter > 1000:
        import time
        timestamp = int(time.time())
        new_filename = f"{clean_base_name}_{timestamp}{extension}"
        new_destination_path = folder_path / new_filename
    
    return new_destination_path

def organize_photos():
    """ÂÜôÁúü„Éï„Ç°„Ç§„É´„ÇíÊï¥ÁêÜ„Åô„Çã"""
    current_dir = Path('.')
    
    # ÁîªÂÉè„Éï„Ç°„Ç§„É´„ÅÆÊã°ÂºµÂ≠ê
    image_extensions = {
        '.jpg', '.jpeg', '.jfif', '.jpe',
        '.png', '.gif', '.bmp', '.tiff', '.tif',
        '.webp', '.avif', '.heic', '.heif',
        '.raw', '.cr2', '.nef', '.arw', '.dng',
        '.svg', '.ico'
    }
    
    # Êó¢Â≠ò„Éï„Ç©„É´„ÉÄ„ÇíÊ§úÂá∫
    existing_folders = set()
    for item in current_dir.iterdir():
        if item.is_dir() and not item.name.startswith('.') and item.name != '__pycache__':
            existing_folders.add(item.name)
    
    print(f"Êó¢Â≠ò„Éï„Ç©„É´„ÉÄÊï∞: {len(existing_folders)}")
    if existing_folders:
        print(f"Êó¢Â≠ò„Éï„Ç©„É´„ÉÄ„ÅÆ‰æã: {list(sorted(existing_folders))[:5]}")
    
    # ÁîªÂÉè„Éï„Ç°„Ç§„É´„ÇíÂèñÂæó
    image_files = []
    for file_path in current_dir.iterdir():
        if file_path.is_file() and file_path.suffix.lower() in image_extensions:
            image_files.append(file_path)
    
    print(f"Ë¶ã„Å§„Åã„Å£„ÅüÁîªÂÉè„Éï„Ç°„Ç§„É´Êï∞: {len(image_files)}")
    
    if len(image_files) == 0:
        print("Êï¥ÁêÜÂØæË±°„ÅÆÁîªÂÉè„Éï„Ç°„Ç§„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ")
        return False
    
    # „Éï„Ç°„Ç§„É´Âêç„ÇíËß£Êûê„Åó„Å¶„Éô„Éº„ÇπÂêç„ÇíÊäΩÂá∫
    base_names = {}
    for file_path in image_files:
        file_name = file_path.stem
        
        # ÁâπÊÆä„Éë„Çø„Éº„É≥„ÅÆÈô§Âéª
        clean_name = re.sub(r'\\s*-\\s*„Ç≥„Éî„Éº$', '', file_name)
        clean_name = re.sub(r'\\s*„Ç≥„Éî„Éº$', '', clean_name)
        clean_name = re.sub(r'photo-\\d+\\s*\\(\\d+\\)\\s*-\\s*„Ç≥„Éî„Éº$', '', clean_name)
        
        # "ÂêçÂâç (Êï∞Â≠ó)" „Éë„Çø„Éº„É≥„ÅÆÂá¶ÁêÜ
        match = re.match(r'^(.+?)\\s*\\((\\d+)\\)$', clean_name)
        base_name = match.group(1).strip() if match else clean_name.strip()
        
        # Ë§áÊï∞‰∫∫Âêç„ÅÆÂá¶ÁêÜ: Êó¢Â≠ò„Éï„Ç©„É´„ÉÄÂêç„ÅßÂßã„Åæ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        target_folder = None
        for folder_name in sorted(existing_folders, key=len, reverse=True):
            if base_name.startswith(folder_name) and len(base_name) > len(folder_name):
                target_folder = folder_name
                print(f"Ë§áÊï∞‰∫∫ÂêçÊ§úÂá∫: '{base_name}' ‚Üí '{target_folder}' „Éï„Ç©„É´„ÉÄ„Å´ÁßªÂãï‰∫àÂÆö")
                break
        
        final_base_name = target_folder if target_folder else base_name
        
        if final_base_name not in base_names:
            base_names[final_base_name] = []
        base_names[final_base_name].append(file_path)
    
    # Âá¶ÁêÜÂØæË±°„Ç∞„É´„Éº„Éó„ÇíÊ±∫ÂÆö
    groups_to_process = {}
    for base_name, files in base_names.items():
        if len(files) > 1:
            # Ë§áÊï∞„Éï„Ç°„Ç§„É´„ÅØÂ∏∏„Å´Âá¶ÁêÜÂØæË±°
            groups_to_process[base_name] = files
            print(f"'{base_name}' „Éï„Ç©„É´„ÉÄ: {len(files)}ÂÄã„ÅÆ„Éï„Ç°„Ç§„É´")
        elif len(files) == 1:
            # 1„Éï„Ç°„Ç§„É´„Åß„ÇÇÊó¢Â≠ò„Éï„Ç©„É´„ÉÄ„Å®Âêå„ÅòÂêçÂâç„Å™„ÇâÂá¶ÁêÜÂØæË±°
            if base_name in existing_folders:
                groups_to_process[base_name] = files
                print(f"'{base_name}' „Éï„Ç©„É´„ÉÄ: {len(files)}ÂÄã„ÅÆ„Éï„Ç°„Ç§„É´ÔºàÊó¢Â≠ò„Éï„Ç©„É´„ÉÄ„Å´ÁßªÂãïÔºâ")
            else:
                print(f"'{base_name}': 1ÂÄã„ÅÆ„Éï„Ç°„Ç§„É´„ÅÆ„ÅøÔºà„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„ÅôÔºâ")
    
    if len(groups_to_process) == 0:
        print("\\nÊï¥ÁêÜÂØæË±°„ÅÆ„Éï„Ç°„Ç§„É´„Ç∞„É´„Éº„Éó„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ")
        return False
    
    total_files = sum(len(files) for files in groups_to_process.values())
    print(f"\\nÂêàË®à {total_files} ÂÄã„ÅÆ„Éï„Ç°„Ç§„É´„Çí {len(groups_to_process)} ÂÄã„ÅÆ„Éï„Ç©„É´„ÉÄ„Å´Êï¥ÁêÜ„Åó„Åæ„Åô„ÄÇ")
    
    # ÂÆüË°åÁ¢∫Ë™ç
    response = input("\\nÂÆüË°å„Åó„Åæ„Åô„ÅãÔºü (y/n): ")
    if response.lower() not in ['y', 'yes', '„ÅØ„ÅÑ']:
        print("„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åæ„Åó„Åü„ÄÇ")
        return False
    
    # „Éï„Ç°„Ç§„É´ÁßªÂãïÂá¶ÁêÜ
    moved_count = 0
    error_count = 0
    
    for base_name, files in groups_to_process.items():
        print(f"\\n'{base_name}' „Ç∞„É´„Éº„Éó„ÇíÂá¶ÁêÜ‰∏≠...")
        
        # „Éï„Ç©„É´„ÉÄ„Çí‰ΩúÊàê
        folder_path = current_dir / base_name
        folder_path.mkdir(exist_ok=True)
        
        # „Éï„Ç°„Ç§„É´„ÇíÁßªÂãï
        for file_path in files:
            try:
                destination = get_unique_filename(folder_path, file_path.name)
                shutil.move(str(file_path), str(destination))
                
                if destination.name != file_path.name:
                    print(f"  ÂêçÂâçÂ§âÊõ¥: {file_path.name} ‚Üí {destination.name}")
                else:
                    print(f"  ÁßªÂãï: {file_path.name} ‚Üí {base_name}/")
                moved_count += 1
            except Exception as e:
                print(f"  „Ç®„É©„Éº: {file_path.name} „ÅÆÁßªÂãï„Å´Â§±Êïó - {e}")
                error_count += 1
    
    print(f"\\n=== Êï¥ÁêÜÂÆå‰∫Ü ===")
    print(f"ÁßªÂãïÊàêÂäü: {moved_count} „Éï„Ç°„Ç§„É´")
    if error_count > 0:
        print(f"ÁßªÂãïÂ§±Êïó: {error_count} „Éï„Ç°„Ç§„É´")
    
    return True

if __name__ == "__main__":
    print("=" * 50)
    print("ÂÜôÁúüÊï¥ÁêÜ„ÉÑ„Éº„É´ - „Ç´„Çπ„Çø„É†Áâà")
    print("=" * 50)
    
    try:
        success = organize_photos()
        if success:
            print("\\nÊï¥ÁêÜ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ")
        else:
            print("\\nÊï¥ÁêÜ„Çí‰∏≠Ê≠¢„Åó„Åæ„Åó„Åü„ÄÇ")
    except KeyboardInterrupt:
        print("\\n\\n„É¶„Éº„Ç∂„Éº„Å´„Çà„Å£„Å¶‰∏≠Êñ≠„Åï„Çå„Åæ„Åó„Åü„ÄÇ")
    except Exception as e:
        print(f"\\n‰∫àÊúü„Åó„Å™„ÅÑ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: {e}")
    
    input("\\nEnter„Ç≠„Éº„ÇíÊäº„Åó„Å¶ÁµÇ‰∫Ü...")
`;

        return script;
      }

      // „Éê„ÉÉ„ÉÅ„Éï„Ç°„Ç§„É´ÁîüÊàêÔºàWindowsÁî®Ôºâ
      function generateBatchScript() {
        return `@echo off
chcp 65001 > nul
echo ==========================================
echo ÂÜôÁúüÊï¥ÁêÜ„ÉÑ„Éº„É´ - Ëá™ÂãïÂÆüË°å
echo ==========================================
echo.

REM Python„Åå„Ç§„É≥„Çπ„Éà„Éº„É´„Åï„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
python --version > nul 2>&1
if errorlevel 1 (
    echo „Ç®„É©„Éº: Python„Åå„Ç§„É≥„Çπ„Éà„Éº„É´„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
    echo https://www.python.org/ „Åã„ÇâPython„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Å¶„Ç§„É≥„Çπ„Éà„Éº„É´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
    echo.
    pause
    exit /b 1
)

echo Python„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„Åü„ÄÇ
echo ÂÜôÁúüÊï¥ÁêÜ„Çπ„ÇØ„É™„Éó„Éà„ÇíÂÆüË°å„Åó„Åæ„Åô...
echo.

REM „Çπ„ÇØ„É™„Éó„Éà„ÇíÂÆüË°å
python photo_organizer_custom.py

echo.
echo ÂÆüË°å„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ
pause
`;
      }

      // Python„Çπ„ÇØ„É™„Éó„ÉàÁîüÊàêÔºàÂæìÊù•ÁâàÔºâ
      function generatePythonScript() {
        let script = `#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ÂÜôÁúüÊï¥ÁêÜ„Çπ„ÇØ„É™„Éó„Éà - GUIÁâà„ÅßÁîüÊàê
„Åì„ÅÆ„Çπ„ÇØ„É™„Éó„Éà„ÅØÂÜôÁúüÊï¥ÁêÜ„ÉÑ„Éº„É´GUIÁâà„ÅßÁîüÊàê„Åï„Çå„Åæ„Åó„Åü„ÄÇ

Ê≥®ÊÑè: „Åì„ÅÆ„Çπ„ÇØ„É™„Éó„Éà„ÅØ2ÂÄã‰ª•‰∏ä„ÅÆÂêåÂêç„Éï„Ç°„Ç§„É´„Åå„ÅÇ„Çã„Ç∞„É´„Éº„Éó„ÅÆ„Åø„ÇíÂá¶ÁêÜ„Åó„Åæ„Åô„ÄÇ
1ÂÄã„ÅÆ„Åø„ÅÆ„Éï„Ç°„Ç§„É´„ÅØ„Åù„ÅÆ„Åæ„ÅæÊÆã„Åï„Çå„Åæ„Åô„ÄÇ
"""

import os
import shutil
from pathlib import Path

def organize_photos():
    """ÂÜôÁúü„Éï„Ç°„Ç§„É´„ÇíÊï¥ÁêÜ„Åô„ÇãÔºà1„Éï„Ç°„Ç§„É´„ÅÆ„Ç∞„É´„Éº„Éó„ÅØ„Çπ„Ç≠„ÉÉ„ÉóÔºâ"""
    current_dir = Path('.')
    
    print("ÂÜôÁúüÊï¥ÁêÜ„ÇíÈñãÂßã„Åó„Åæ„Åô...")
    print("Ê≥®ÊÑè: 1ÂÄã„ÅÆ„Åø„ÅÆ„Éï„Ç°„Ç§„É´„ÅØ„Éï„Ç©„É´„ÉÄ„Å´ÁßªÂãï„Åï„Çå„Åæ„Åõ„Çì„ÄÇ")
    
    # Êï¥ÁêÜË®àÁîª
    organization_plan = {
`;

        Object.entries(organizationPlan).forEach(([folderName, files]) => {
          script += `        "${folderName}": [\n`;
          files.forEach((file) => {
            script += `            "${file.name}",\n`;
          });
          script += `        ],\n`;
        });

        script += `    }
    
    print("ÂÜôÁúüÊï¥ÁêÜ„ÇíÈñãÂßã„Åó„Åæ„Åô...")
    
    for folder_name, file_names in organization_plan.items():
        print(f"\\n'{folder_name}' „Éï„Ç©„É´„ÉÄ„Çí‰ΩúÊàê‰∏≠...")
        folder_path = current_dir / folder_name
        folder_path.mkdir(exist_ok=True)
        
        for file_name in file_names:
            source_file = current_dir / file_name
            if source_file.exists():
                destination = folder_path / file_name
                try:
                    shutil.move(str(source_file), str(destination))
                    print(f"  ÁßªÂãï: {file_name} ‚Üí {folder_name}/")
                except Exception as e:
                    print(f"  „Ç®„É©„Éº: {file_name} „ÅÆÁßªÂãï„Å´Â§±Êïó - {e}")
            else:
                print(f"  Ë≠¶Âëä: {file_name} „ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì")
    
    print("\\nÊï¥ÁêÜÂÆå‰∫ÜÔºÅ")

if __name__ == "__main__":
    response = input("ÂÜôÁúü„Éï„Ç°„Ç§„É´„ÇíÊï¥ÁêÜ„Åó„Åæ„Åô„ÅãÔºü (y/n): ")
    if response.lower() in ['y', 'yes', '„ÅØ„ÅÑ']:
        organize_photos()
    else:
        print("„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åæ„Åó„Åü„ÄÇ")
`;

        return script;
      }

      // CSV„É¨„Éù„Éº„ÉàÁîüÊàê
      function generateCSVReport() {
        let csv = "„Éï„Ç©„É´„ÉÄÂêç,„Éï„Ç°„Ç§„É´Êï∞,„Éï„Ç°„Ç§„É´‰∏ÄË¶ß\\n";

        Object.entries(organizationPlan).forEach(([folderName, files]) => {
          const fileNames = files.map((f) => f.name).join("; ");
          csv += `"${folderName}",${files.length},"${fileNames}"\\n`;
        });

        return csv;
      }

      // ÂàùÊúüÂåñ
      document.addEventListener("DOMContentLoaded", function () {
        log("ÂÜôÁúüÊï¥ÁêÜ„ÉÑ„Éº„É´ GUIÁâà„ÅåËµ∑Âãï„Åó„Åæ„Åó„Åü", "info");
        log("„Éï„Ç©„É´„ÉÄ„ÇíÈÅ∏Êäû„Åó„Å¶ÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ", "info");

        // „É¢„Éº„ÉÄ„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        window.addEventListener("click", function (event) {
          const modal = document.getElementById("executionModal");
          if (event.target === modal) {
            closeModal();
          }
        });
      });
    </script>
  </body>
</html>
