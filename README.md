# 写真整理ツール (Photo Organizer) v3.0

同じ名前の写真ファイルを各々のフォルダにまとめる便利なツールです。

## 🎯 機能

- **自動グループ化**: 同じ名前の写真ファイル（例：`犬.jpg`, `犬 (1).jpg`, `犬 (2).png`）を一つのフォルダにまとめます
- **1 ファイルスキップ**: 1 個のみのファイルはそのまま残し、2 個以上の同名ファイルがある場合のみフォルダに整理します
- **複数動物名対応**: `いぬねこ.jpg` のような複数動物名のファイルを、先頭の名前（`いぬ`）のフォルダに移動します
- **厳密な名前判定**: `桜.jpg`、`桜井.jpg`、`桜田.jpg` のような似た名前を正しく区別して整理します
- **統合処理の制御**: `--no-merge` オプションで複数人名の統合処理を無効化できます
- **特殊パターン処理**: 「コピー」や「photo-1」などの特殊な命名パターンにも対応
- **重複ファイル処理**: 同名ファイルが既に存在する場合、自動的に名前を変更します
- **多様な画像形式**: JPG、PNG、GIF、BMP、TIFF、WebP、RAW、CR2、NEF などに対応

## 📋 必要な環境

- Python 3.6 以上
- 標準ライブラリのみ使用（追加インストール不要）

## 🚀 使い方

### 🔧 コマンドライン版 - 基本的な使用方法

**効率的で柔軟な操作が可能です。**

#### 基本的な使用方法

```bash
# 現在のディレクトリを整理
python photo_organizer.py

# 指定したディレクトリを整理
python photo_organizer.py "C:\Users\YourName\Pictures"

# 複数人名の統合を無効化して整理（推奨）
python photo_organizer.py --no-merge

# 指定ディレクトリで複数人名統合を無効化
python photo_organizer.py --no-merge "C:\Users\YourName\Pictures"

# ヘルプを表示
python photo_organizer.py --help

# バージョンを表示
python photo_organizer.py --version
```

#### 実行の流れ

```
1. 📂 対象フォルダの確認
2. 🖼️  画像ファイルの検出
3. 📋 整理プレビューの表示
4. 🤔 実行確認（y/n）
5. 🚀 ファイル移動の実行
6. ✅ 結果の表示
```

### 📱 ブラウザ版 - GUI 操作

**マウスで操作したい方におすすめです。実際のファイル移動はせず、安全に整理計画を作成できます。**

#### 📋 ステップバイステップガイド

**ステップ 1: HTML ファイルを開く**

```bash
# 方法A: ファイルをダブルクリック
photo_organizer_gui.html をダブルクリック

# 方法B: ブラウザから開く
ブラウザを起動 → ファイル → 開く → photo_organizer_gui.html を選択
```

**ステップ 2: フォルダを選択**

```
1. 「📁 フォルダを選択」ボタンをクリック
2. 整理したい写真フォルダを選択
3. 「選択」をクリック
   ※ フォルダ内の全ファイルが読み込まれます
```

**ステップ 3: ファイルを解析**

```
1. 「🔍 ファイルを解析」ボタンをクリック
2. 画像ファイルが自動的に検出されます
3. 統計情報が表示されます
   - 総ファイル数
   - グループ数
   - 重複ファイル数
```

**ステップ 4: プレビューを確認**

```
1. 「👁️ 整理プレビュー」ボタンをクリック
2. 作成されるフォルダとファイル数を確認
3. スキップされるファイル（1個のみ）も表示されます
```

**ステップ 5: 整理計画をダウンロード**

```
1. 「💾 整理計画をダウンロード」ボタンをクリック
2. 2つのファイルがダウンロードされます：
   - photo_organizer_plan.py（実行用スクリプト）
   - organization_plan.csv（整理計画の詳細）
```

**ステップ 6: ダウンロードしたスクリプトを実行**

**方法 A: ダブルクリック実行（Windows）**

```
1. ダウンロードフォルダを開く
2. photo_organizer_plan.py をダブルクリック
3. 「実行しますか？ (y/n):」と表示されたら「y」を入力
4. Enterキーを押す
5. 整理が実行されます
```

**方法 B: コマンドライン実行**

```bash
# 1. ダウンロードフォルダに移動
cd C:\Users\YourName\Downloads

# 2. スクリプトを写真フォルダにコピー
copy photo_organizer_plan.py "C:\Users\YourName\Pictures"

# 3. 写真フォルダに移動
cd "C:\Users\YourName\Pictures"

# 4. スクリプトを実行
python photo_organizer_plan.py
```

**方法 C: 写真フォルダに直接移動して実行**

```bash
# 1. ダウンロードしたファイルを写真フォルダに移動
# 2. 写真フォルダでコマンドプロンプトを開く
#    （フォルダ内でShift+右クリック → 「PowerShellウィンドウをここで開く」）
# 3. スクリプトを実行
python photo_organizer_plan.py
```

### 🌐 Web アプリ版 - 本格運用

**大量のファイルを効率的に処理したい方向けです。実際のファイル移動が可能です。**

#### 📋 セットアップ手順

**ステップ 1: Flask をインストール**

```bash
# コマンドプロンプトまたはPowerShellで実行
pip install flask

# インストール確認
pip show flask
```

**ステップ 2: サーバーを起動**

```bash
# photo-organizerフォルダに移動
cd "C:\デスクトップ\atsuki's-project\photo-organizer"

# サーバーを起動
python photo_organizer_webapp.py

# 以下のメッセージが表示されれば成功：
# ブラウザで http://localhost:5000 にアクセスしてください
```

**ステップ 3: ブラウザでアクセス**

```
1. ブラウザを開く
2. アドレスバーに「http://localhost:5000」を入力
3. Enterキーを押す
4. 写真整理ツールのページが表示されます
```

#### 📋 使用方法

**ステップ 1: フォルダパスを入力**

```
1. 「📂 ディレクトリパス」欄に写真フォルダのパスを入力
   例: C:\Users\YourName\Pictures
   例: C:\Users\YourName\Desktop\写真フォルダ

2. 「🔍 解析開始」ボタンをクリック
```

**ステップ 2: 解析結果を確認**

```
1. 解析が完了すると統計情報が表示されます：
   - 総ファイル数
   - 作成されるフォルダ数
   - 既存フォルダ数

2. 「📋 プレビューを表示」ボタンをクリック
```

**ステップ 3: プレビューを確認**

```
1. 作成される各フォルダとファイル数を確認
2. 移動されるファイルの一覧を確認
3. 問題がなければ次のステップへ
```

**ステップ 4: 整理を実行**

```
1. 「🚀 整理を実行」ボタンをクリック
2. 確認ダイアログで「OK」をクリック
3. 実際にファイルが移動されます
4. 結果が表示されます：
   - 移動成功ファイル数
   - 作成されたフォルダ数
   - エラーがあれば詳細
```

#### 🛑 サーバーの停止方法

```bash
# コマンドプロンプトで Ctrl+C を押す
# または、コマンドプロンプトを閉じる
```

### 🔧 コマンドライン版 - 上級者向け

**自動化やスクリプト組み込みに適しています。**

#### 基本的な使用方法

```bash
# 現在のディレクトリを整理
python photo_organizer.py

# 指定したディレクトリを整理
python photo_organizer.py "C:\Users\YourName\Pictures"

# 複数人名統合を無効化（安全な整理）
python photo_organizer.py --no-merge

# 指定ディレクトリで複数人名統合を無効化
python photo_organizer.py --no-merge "C:\Users\YourName\Pictures"

# ヘルプを表示
python photo_organizer.py --help

# バージョンを表示
python photo_organizer.py --version
```

#### バッチ処理例

```bash
# 複数フォルダの一括処理（安全モード）
python photo_organizer.py --no-merge "C:\Photos\2023"
python photo_organizer.py --no-merge "C:\Photos\2024"
python photo_organizer.py --no-merge "C:\Photos\2025"

# 従来の処理（複数人名統合あり）
python photo_organizer.py "C:\Photos\2023"
python photo_organizer.py "C:\Photos\2024"
python photo_organizer.py "C:\Photos\2025"
```

## 📖 詳細な使用例

### 例 1: 基本的な整理

**整理前のフォルダ**

```
📁 写真フォルダ/
├── ねこ.jpg
├── ねこ (1).jpg
├── ねこ (2).png
├── いぬ.jpg
├── いぬ (1).jpg
└── 単独ファイル.jpg  ← 1個のみ
```

**実行コマンド**

```bash
python photo_organizer_standalone.py
```

**整理後のフォルダ**

```
📁 写真フォルダ/
├── 📁 ねこ/
│   ├── ねこ.jpg
│   ├── ねこ (1).jpg
│   └── ねこ (2).png
├── 📁 いぬ/
│   ├── いぬ.jpg
│   └── いぬ (1).jpg
└── 単独ファイル.jpg  ← そのまま残る
```

### 例 2: 複数人名ファイルの処理

**整理前**

```
📁 写真フォルダ/
├── 📁 いぬ/          ← 既存フォルダ
│   └── いぬ.jpg
├── いぬねこ.jpg      ← 複数動物名ファイル
└── いぬうさぎ.jpg    ← 複数動物名ファイル
```

**整理後**

```
📁 写真フォルダ/
└── 📁 いぬ/
    ├── いぬ.jpg
    ├── いぬねこ.jpg      ← 自動的にいぬフォルダに移動
    └── いぬうさぎ.jpg    ← 自動的にいぬフォルダに移動
```

### 例 3: 厳密な名前判定の改善（NEW!）

**従来の問題（改善前）**

```
📁 写真フォルダ/
├── 桜.jpg
├── 桜井.jpg    ← 間違って「桜」フォルダに統合されてしまう
└── 桜田.jpg          ← 間違って「桜」フォルダに統合されてしまう
```

**改善後の正しい整理**

```bash
# デフォルト（厳密な判定）
python photo_organizer.py

# または、統合処理を完全無効化（推奨）
python photo_organizer.py --no-merge
```

```
📁 写真フォルダ/
├── 📁 桜/
│   └── 桜.jpg
├── 📁 桜井/    ← 正しく独立したフォルダに整理
│   └── 桜井.jpg
└── 📁 桜田/          ← 正しく独立したフォルダに整理
    └── 桜田.jpg
```

**安全な運用方法**

```bash
# 複数人名統合を無効化（最も安全）
python photo_organizer.py --no-merge

# 既存フォルダがある場合の安全確認
python photo_organizer.py --no-merge "C:\Photos"
```

### 例 4: 重複ファイル名の処理

**同名ファイルが既に存在する場合**

```
移動前: ねこ.jpg → ねこ/ねこ.jpg（既存）
移動後: ねこ.jpg → ねこ/ねこ_copy1.jpg（自動リネーム）
```

## ⚡ クイックスタートガイド

### 🚀 30 秒で始める

1. **移動**: 整理したい写真フォルダに移動
2. **実行**: `python photo_organizer.py` を実行
3. **確認**: プレビューを見て `y` を入力
4. **完了**: 整理されたフォルダを確認

### 🛡️ 安全に試す方法

```bash
# 1. テスト用フォルダを作成
mkdir test_photos
cd test_photos

# 2. テスト用ファイルをコピー
# （重要な写真の前に、不要なファイルでテスト）

# 3. 写真整理ツールを実行（推奨：安全モード）
python photo_organizer.py --no-merge

# または、従来の方法
python photo_organizer.py

# 4. 結果を確認してから本番実行
```

## 📸 対応画像形式

このツールは以下の画像形式に対応しています：

### JPEG 系

- `.jpg`, `.jpeg`, `.jfif`, `.jpe`

### 一般的な形式

- `.png`, `.gif`, `.bmp`, `.tiff`, `.tif`

### 新しい形式

- `.webp`, `.avif`, `.heic`, `.heif`

### RAW 形式

- `.raw`, `.cr2`, `.nef`, `.arw`, `.dng`

### その他

- `.svg`, `.ico`

## 🎨 各バージョンの選び方

| 用途                 | 推奨バージョン      | 理由                   |
| -------------------- | ------------------- | ---------------------- |
| **基本的な整理**     | 🔧 コマンドライン版 | 効率的、柔軟性が高い   |
| **マウス操作したい** | 📱 GUI 版           | 視覚的で分かりやすい   |
| **大量処理**         | 🌐 Web アプリ版     | 高機能、効率的         |
| **自動化したい**     | 🔧 コマンドライン版 | スクリプト組み込み可能 |
| **プログラマー**     | 🔧 コマンドライン版 | カスタマイズ性が高い   |

## 🔧 カスタマイズ

スクリプトを編集して以下をカスタマイズできます：

- **対応画像形式**: `image_extensions` セットを編集
- **特殊パターン**: 正規表現パターンを追加
- **フォルダ名ルール**: `extract_base_name` 関数を変更

## 🔄 逆整理ツール（NEW!）

写真整理ツールで作成されたフォルダから写真ファイルを取り出して、元の状態に戻すツールも用意しました！

### 🚀 使用方法

```bash
# 現在のディレクトリを処理
python photo_unorganizer.py

# 指定したディレクトリを処理
python photo_unorganizer.py "C:\Photos"

# 空フォルダを残す場合
python photo_unorganizer.py --keep-folders

# ヘルプを表示
python photo_unorganizer.py --help
```

### 📋 逆整理の例

**逆整理前（整理済み状態）**

```
📁 写真フォルダ/
├── 📁 ねこ/
│   ├── ねこ.jpg
│   ├── ねこ (1).jpg
│   └── ねこ (2).png
├── 📁 いぬ/
│   ├── いぬ.jpg
│   └── いぬ (1).jpg
└── 単独ファイル.jpg
```

**逆整理後（元の状態）**

```
📁 写真フォルダ/
├── ねこ.jpg
├── ねこ (1).jpg
├── ねこ (2).png
├── いぬ.jpg
├── いぬ (1).jpg
└── 単独ファイル.jpg
```

### 🛡️ 安全機能

- **実行前プレビュー**: 移動予定のファイルを事前に確認
- **重複回避**: 同名ファイルが存在する場合、自動的に名前を変更
- **空フォルダ削除**: 空になったフォルダを自動削除（オプション）
- **エラーハンドリング**: ファイル移動エラーを適切に処理

## 📦 ファイル構成

```
photo-organizer/
├── photo_organizer.py                # 🔧 コマンドライン版（推奨）
├── photo_organizer_webapp.py         # 🌐 Webアプリ版
├── photo_organizer_gui.html          # 📱 GUI版
├── photo_unorganizer.py              # 🔄 逆整理ツール（NEW!）
├── README.md                         # 📖 このファイル
└── GUI_README.md                     # 📖 GUI版詳細ガイド
```

## 🛡️ 安全機能

- **実行前確認**: 移動予定を表示し、実行前に確認を求めます
- **エラーハンドリング**: ファイル移動エラーを適切に処理し、続行します
- **重複回避**: 同名ファイルが存在する場合、自動的に名前を変更します
- **バックアップ推奨**: 重要なファイルは事前にバックアップを取ることをお勧めします

## 🐛 トラブルシューティング

### よくある問題と解決方法

#### 1. 「python コマンドが見つかりません」

```bash
# 解決方法
# - Pythonをインストール: https://python.org
# - または python3 コマンドを試す
python3 photo_organizer_standalone.py
```

#### 2. 「アクセスが拒否されました」

```bash
# 解決方法
# - ファイルが開かれていないか確認
# - 管理者権限で実行
# - ファイルの読み取り専用属性を解除
```

#### 3. 「ファイルが移動されない」

```bash
# 確認事項
# - 画像ファイルが存在するか
# - ファイル拡張子が対応形式か
# - 2個以上の同名ファイルがあるか
```

#### 4. 「ダブルクリックで実行できない」

```bash
# 解決方法
# - .pyファイルをPythonに関連付け
# - または右クリック → プログラムから開く → Python
```

#### 5. 「Web アプリでエラーが発生する」

```bash
# よくあるエラーと解決方法

# エラー: "NameError: name 'render_template_string' is not defined"
# 解決方法: Flaskのバージョンを確認し、再インストール
pip uninstall flask
pip install flask

# エラー: "ModuleNotFoundError: No module named 'flask'"
# 解決方法: Flaskをインストール
pip install flask

# エラー: "Address already in use"
# 解決方法: 既存のサーバーを停止
# Ctrl+C でサーバーを停止してから再起動

# エラー: "Permission denied"
# 解決方法: 管理者権限で実行
# または、ポート番号を変更（5000 → 8000など）
```

#### 6. 「GUI 版でファイルが選択できない」

```bash
# 解決方法
# - ブラウザのセキュリティ設定を確認
# - Chrome/Edgeの場合: ファイルアクセス許可を有効化
# - または、ローカルサーバー経由でアクセス
```

#### 7. 「ダウンロードしたスクリプトが実行できない」

```bash
# 確認事項
# - ダウンロードフォルダにファイルが存在するか
# - ファイル名が正しいか（photo_organizer_plan.py）
# - Pythonがインストールされているか

# 実行方法
# 1. ダウンロードフォルダを開く
# 2. ファイルを右クリック → プログラムから開く → Python
# 3. または、コマンドプロンプトで実行：
cd C:\Users\YourName\Downloads
python photo_organizer_plan.py
```

#### 8. 「逆整理ツールで元に戻らない」

```bash
# よくある原因と解決方法

# 原因1: フォルダ内に画像ファイルがない
# 解決方法: フォルダ内に画像ファイルがあることを確認

# 原因2: 他のファイルがフォルダに残っている
# 解決方法: フォルダは削除されませんが、画像ファイルは移動されます

# 原因3: ファイル名が重複している
# 解決方法: 自動的に番号が付与されます（例：ファイル (1).jpg）

# 確認方法
# - 逆整理前にプレビューを確認
# - 移動されたファイル数を確認
# - エラーメッセージがないか確認
```

#### 9. 「整理と逆整理を繰り返すとファイル名が変わる」

```bash
# 現象: ファイル名に番号が増えていく
# 例: ねこ.jpg → ねこ (1).jpg → ねこ (2).jpg

# 原因: 重複回避機能が働いている

# 対策:
# 1. 整理前にバックアップを作成
# 2. 一度だけ整理/逆整理を実行
# 3. 必要に応じて手動でファイル名を修正
```

### 📞 サポート

問題が発生した場合は、以下の情報と共にお知らせください：

- 使用 OS（Windows/Mac/Linux）
- Python バージョン
- エラーメッセージ
- 実行したコマンド

## 📝 ライセンス

このツールは自由に使用、改変、配布できます。

---

**Photo Organizer v3.0** - あなたの写真整理を簡単に！
